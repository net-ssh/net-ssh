<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Net::SSH::KeyFactory - net-ssh 4.0.1.rc2</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-get">::get</a>
    
    <li ><a href="#method-c-load_data_private_key">::load_data_private_key</a>
    
    <li ><a href="#method-c-load_data_public_key">::load_data_public_key</a>
    
    <li ><a href="#method-c-load_private_key">::load_private_key</a>
    
    <li ><a href="#method-c-load_public_key">::load_public_key</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Net::SSH::KeyFactory">
  <h1 id="class-Net::SSH::KeyFactory" class="class">
    class Net::SSH::KeyFactory
  </h1>

  <section class="description">
    
<p>A factory class for returning new Key classes. It is used for obtaining <a
href="KeyFactory/OpenSSL.html">OpenSSL</a> key instances via their <a
href="../SSH.html">SSH</a> names, and for loading both public and private
keys. It used used primarily by <a href="../SSH.html">Net::SSH</a> itself,
internally, and will rarely (if ever) be directly used by consumers of the
library.</p>

<pre class="ruby"><span class="ruby-identifier">klass</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">KeyFactory</span>.<span class="ruby-identifier">get</span>(<span class="ruby-string">&quot;rsa&quot;</span>)
<span class="ruby-identifier">assert</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>)

<span class="ruby-identifier">key</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">KeyFactory</span>.<span class="ruby-identifier">load_public_key</span>(<span class="ruby-string">&quot;~/.ssh/id_dsa.pub&quot;</span>)
</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="MAP">MAP
        
        <dd><p>Specifies the mapping of <a href="../SSH.html">SSH</a> names to <a
href="KeyFactory/OpenSSL.html">OpenSSL</a> key classes.</p>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Fetch an <a href="KeyFactory/OpenSSL.html">OpenSSL</a> key instance by its
<a href="../SSH.html">SSH</a> name. It will be a new, empty key of the
given type.</p>
          
          

          
          <div class="method-source-code" id="get-source">
            <pre><span class="ruby-comment"># File lib/net/ssh/key_factory.rb, line 32</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-constant">MAP</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-load_data_private_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_data_private_key</span><span
            class="method-args">(data, passphrase=nil, ask_passphrase=true, filename="", prompt=Prompt.default)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads a private key. It will correctly determine whether the file describes
an RSA or DSA key, and will load it appropriately. The new key is returned.
If the key itself is encrypted (requiring a passphrase to use), the user
will be prompted to enter their password unless passphrase works.</p>
          
          

          
          <div class="method-source-code" id="load_data_private_key-source">
            <pre><span class="ruby-comment"># File lib/net/ssh/key_factory.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_data_private_key</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">passphrase</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">ask_passphrase</span>=<span class="ruby-keyword">true</span>, <span class="ruby-identifier">filename</span>=<span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">prompt</span>=<span class="ruby-constant">Prompt</span>.<span class="ruby-identifier">default</span>)
  <span class="ruby-identifier">key_read</span>, <span class="ruby-identifier">error_classes</span> = <span class="ruby-identifier">classify_key</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">filename</span>)

  <span class="ruby-identifier">encrypted_key</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/ENCRYPTED/</span>)
  <span class="ruby-identifier">tries</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">prompter</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">result</span> =
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">key_read</span>[<span class="ruby-identifier">data</span>, <span class="ruby-identifier">passphrase</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;invalid&#39;</span>]
    <span class="ruby-keyword">rescue</span> <span class="ruby-operator">*</span><span class="ruby-identifier">error_classes</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">encrypted_key</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ask_passphrase</span>
        <span class="ruby-identifier">tries</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">tries</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">3</span>
          <span class="ruby-identifier">prompter</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">prompt</span>.<span class="ruby-identifier">start</span>(<span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;private_key&#39;</span>, <span class="ruby-identifier">filename</span><span class="ruby-operator">:</span> <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">sha</span><span class="ruby-operator">:</span> <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">data</span>))
          <span class="ruby-identifier">passphrase</span> = <span class="ruby-identifier">prompter</span>.<span class="ruby-identifier">ask</span>(<span class="ruby-node">&quot;Enter passphrase for #{filename}:&quot;</span>, <span class="ruby-keyword">false</span>)
          <span class="ruby-keyword">retry</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">raise</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">raise</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">prompter</span>.<span class="ruby-identifier">success</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">prompter</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-load_data_public_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_data_public_key</span><span
            class="method-args">(data, filename="")</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads a public key. It will correctly determine whether the file describes
an RSA or DSA key, and will load it appropriately. The new public key is
returned.</p>
          
          

          
          <div class="method-source-code" id="load_data_public_key-source">
            <pre><span class="ruby-comment"># File lib/net/ssh/key_factory.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_data_public_key</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">filename</span>=<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/ /</span>)

  <span class="ruby-identifier">blob</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">blob</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">shift</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">blob</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-regexp">/^(ssh-(rsa|dss|ed25519)|ecdsa-sha2-nistp\d+)$/</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">blob</span>)
  <span class="ruby-identifier">blob</span> = <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">shift</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>, <span class="ruby-node">&quot;public key at #{filename} is not valid&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">blob</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">blob</span> = <span class="ruby-identifier">blob</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-string">&quot;m*&quot;</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">reader</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">blob</span>)
  <span class="ruby-identifier">reader</span>.<span class="ruby-identifier">read_key</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">PKeyError</span>, <span class="ruby-node">&quot;not a public key #{filename.inspect}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-load_private_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_private_key</span><span
            class="method-args">(filename, passphrase=nil, ask_passphrase=true, prompt=Prompt.default)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads a private key from a file. It will correctly determine whether the
file describes an RSA or DSA key, and will load it appropriately. The new
key is returned. If the key itself is encrypted (requiring a passphrase to
use), the user will be prompted to enter their password unless passphrase
works.</p>
          
          

          
          <div class="method-source-code" id="load_private_key-source">
            <pre><span class="ruby-comment"># File lib/net/ssh/key_factory.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_private_key</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">passphrase</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">ask_passphrase</span>=<span class="ruby-keyword">true</span>, <span class="ruby-identifier">prompt</span>=<span class="ruby-constant">Prompt</span>.<span class="ruby-identifier">default</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">filename</span>))
  <span class="ruby-identifier">load_data_private_key</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">passphrase</span>, <span class="ruby-identifier">ask_passphrase</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">prompt</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-load_public_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_public_key</span><span
            class="method-args">(filename)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads a public key from a file. It will correctly determine whether the
file describes an RSA or DSA key, and will load it appropriately. The new
public key is returned.</p>
          
          

          
          <div class="method-source-code" id="load_public_key-source">
            <pre><span class="ruby-comment"># File lib/net/ssh/key_factory.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_public_key</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">filename</span>))
  <span class="ruby-identifier">load_data_public_key</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">filename</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

