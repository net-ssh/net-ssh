<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Net::SSH::Transport::Session [Net::SSH: a pure-Ruby implementation of the SSH2 client protocol.]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Net::SSH::Transport::Session
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../../files/lib/net/ssh/transport/session_rb.html">lib/net/ssh/transport/session.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            The transport layer represents the lowest level of the <a
            href="../../SSH.html">SSH</a> protocol, and implements basic message
            exchanging and protocol initialization. It will never be instantiated
            directly (unless you really know what you&#8217;re about), but will instead
            be created for you automatically when you create a new <a
            href="../../SSH.html">SSH</a> session via <a
            href="../../SSH.html#M000002">Net::SSH.start</a>.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000232">new</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000235">close</a></li>
              <li><a href="#M000234">closed?</a></li>
              <li><a href="#M000247">configure_client</a></li>
              <li><a href="#M000248">configure_server</a></li>
              <li><a href="#M000246">enqueue_message</a></li>
              <li><a href="#M000249">hint</a></li>
              <li><a href="#M000233">host_as_string</a></li>
              <li><a href="#M000241">next_message</a></li>
              <li><a href="#M000240">peer</a></li>
              <li><a href="#M000242">poll_message</a></li>
              <li><a href="#M000244">push</a></li>
              <li><a href="#M000238">rekey!</a></li>
              <li><a href="#M000239">rekey_as_needed</a></li>
              <li><a href="#M000245">send_message</a></li>
              <li><a href="#M000237">service_request</a></li>
              <li><a href="#M000236">shutdown!</a></li>
              <li><a href="#M000243">wait</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li><a href="Constants.html">Constants</a></li>
                <li><a href="../Loggable.html">Loggable</a></li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_PORT</td>
                    <td>=</td>
                    <td class='context-item-value'>22</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      The standard port for the <a href="../../SSH.html">SSH</a> protocol.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>algorithms</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The <a href="Algorithms.html">Algorithms</a> instance used to perform key
                      exchanges.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>host</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The host to connect to, as given to the constructor.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>host_key_verifier</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The host-key verifier object used to verify host keys, to ensure that the
                      connection is not being spoofed.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>options</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The hash of options that were given to the object at initialization.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>port</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The port number to connect to, as given in the options to the constructor.
                      If no port number was given, this will default to DEFAULT_PORT.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>server_version</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The <a href="ServerVersion.html">ServerVersion</a> instance that
                      encapsulates the negotiated protocol version.
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>socket</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      The underlying socket object being used to communicate with the remote
                      host.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='method public-class' id='method-M000232'>
                <a name='M000232'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(host, options={})</span>
                </div>
                <div class='description'>
                  <p>
                  Instantiates a new transport layer abstraction. This will block until the
                  initial key exchange completes, leaving you with a ready-to-use transport
                  session.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000232-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000232-source'>    <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 56</span>&#x000A;56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">options</span>={})&#x000A;57:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:logger</span>]&#x000A;58: &#x000A;59:       <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>&#x000A;60:       <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_PORT</span>&#x000A;61:       <span class="ruby-ivar">@bind_address</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:bind_address</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">nil</span>&#x000A;62:       <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>&#x000A;63: &#x000A;64:       <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;establishing connection to #{@host}:#{@port}&quot;</span> }&#x000A;65:       <span class="ruby-identifier">factory</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:proxy</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">TCPSocket</span>&#x000A;66:       <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">timeout</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>) { <span class="ruby-ivar">@bind_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:proxy</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@host</span>, <span class="ruby-ivar">@port</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@host</span>,<span class="ruby-ivar">@port</span>,<span class="ruby-ivar">@bind_address</span>) }&#x000A;67:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">PacketStream</span>)&#x000A;68:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-ivar">@logger</span>&#x000A;69: &#x000A;70:       <span class="ruby-identifier">debug</span> { <span class="ruby-value str">&quot;connection established&quot;</span> }&#x000A;71: &#x000A;72:       <span class="ruby-ivar">@queue</span> = []&#x000A;73: &#x000A;74:       <span class="ruby-ivar">@host_key_verifier</span> = <span class="ruby-identifier">select_host_key_verifier</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:paranoid</span>])&#x000A;75: &#x000A;76: &#x000A;77:       <span class="ruby-ivar">@server_version</span> = <span class="ruby-identifier">timeout</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>) { <span class="ruby-constant">ServerVersion</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">logger</span>) }&#x000A;78: &#x000A;79:       <span class="ruby-ivar">@algorithms</span> = <span class="ruby-constant">Algorithms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">options</span>)&#x000A;80:       <span class="ruby-identifier">wait</span> { <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">initialized?</span> }&#x000A;81:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000235'>
                <a name='M000235'></a>
                <div class='synopsis'>
                  <span class='name'>close</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Cleans up (see <a
                  href="PacketStream.html#M000207">PacketStream#cleanup</a>) and closes the
                  underlying socket.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000235-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000235-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 104</span>&#x000A;104:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>&#x000A;105:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">cleanup</span>&#x000A;106:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>&#x000A;107:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000234'>
                <a name='M000234'></a>
                <div class='synopsis'>
                  <span class='name'>closed?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns true if the underlying socket has been closed.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000234-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000234-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 99</span>&#x000A; 99:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">closed?</span>&#x000A;100:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">closed?</span>&#x000A;101:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000247'>
                <a name='M000247'></a>
                <div class='synopsis'>
                  <span class='name'>configure_client</span>
                  <span class='arguments'>(options={})</span>
                </div>
                <div class='description'>
                  <p>
                  Configure&#8217;s the packet stream&#8217;s client state with the given set
                  of options. This is typically used to define the cipher, compression, and
                  hmac algorithms to use when sending packets to the server.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000247-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000247-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 231</span>&#x000A;231:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">configure_client</span>(<span class="ruby-identifier">options</span>={})&#x000A;232:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">client</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)&#x000A;233:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000248'>
                <a name='M000248'></a>
                <div class='synopsis'>
                  <span class='name'>configure_server</span>
                  <span class='arguments'>(options={})</span>
                </div>
                <div class='description'>
                  <p>
                  Configure&#8217;s the packet stream&#8217;s server state with the given set
                  of options. This is typically used to define the cipher, compression, and
                  hmac algorithms to use when reading packets from the server.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000248-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000248-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 238</span>&#x000A;238:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">configure_server</span>(<span class="ruby-identifier">options</span>={})&#x000A;239:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">server</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)&#x000A;240:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000246'>
                <a name='M000246'></a>
                <div class='synopsis'>
                  <span class='name'>enqueue_message</span>
                  <span class='arguments'>(message)</span>
                </div>
                <div class='description'>
                  <p>
                  Enqueues the given message, such that it will be sent at the earliest
                  opportunity. This does not block, but returns immediately.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000246-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000246-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 224</span>&#x000A;224:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">enqueue_message</span>(<span class="ruby-identifier">message</span>)&#x000A;225:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">enqueue_packet</span>(<span class="ruby-identifier">message</span>)&#x000A;226:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000249'>
                <a name='M000249'></a>
                <div class='synopsis'>
                  <span class='name'>hint</span>
                  <span class='arguments'>(which, value=true)</span>
                </div>
                <div class='description'>
                  <p>
                  Sets a new hint for the packet stream, which the packet stream may use to
                  change its behavior. (See PacketStream#hints).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000249-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000249-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 244</span>&#x000A;244:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hint</span>(<span class="ruby-identifier">which</span>, <span class="ruby-identifier">value</span>=<span class="ruby-keyword kw">true</span>)&#x000A;245:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">hints</span>[<span class="ruby-identifier">which</span>] = <span class="ruby-identifier">value</span>&#x000A;246:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000233'>
                <a name='M000233'></a>
                <div class='synopsis'>
                  <span class='name'>host_as_string</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns the host (and possibly IP address) in a format compatible with <a
                  href="../../SSH.html">SSH</a> known-host files.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000233-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000233-source'>    <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 85</span>&#x000A;85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">host_as_string</span>&#x000A;86:       <span class="ruby-ivar">@host_as_string</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>&#x000A;87:         <span class="ruby-identifier">string</span> = <span class="ruby-node">&quot;#{host}&quot;</span>&#x000A;88:         <span class="ruby-identifier">string</span> = <span class="ruby-node">&quot;[#{string}]:#{port}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">DEFAULT_PORT</span>&#x000A;89:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">host</span>&#x000A;90:           <span class="ruby-identifier">string2</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span>&#x000A;91:           <span class="ruby-identifier">string2</span> = <span class="ruby-node">&quot;[#{string2}]:#{port}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">DEFAULT_PORT</span>&#x000A;92:           <span class="ruby-identifier">string</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;,&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">string2</span>&#x000A;93:         <span class="ruby-keyword kw">end</span>&#x000A;94:         <span class="ruby-identifier">string</span>&#x000A;95:       <span class="ruby-keyword kw">end</span>&#x000A;96:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000241'>
                <a name='M000241'></a>
                <div class='synopsis'>
                  <span class='name'>next_message</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Blocks until a new packet is available to be read, and returns that packet.
                  See <a href="Session.html#M000242">poll_message</a>.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000241-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000241-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 150</span>&#x000A;150:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_message</span>&#x000A;151:       <span class="ruby-identifier">poll_message</span>(<span class="ruby-identifier">:block</span>)&#x000A;152:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000240'>
                <a name='M000240'></a>
                <div class='synopsis'>
                  <span class='name'>peer</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a hash of information about the peer (remote) side of the socket,
                  including :ip, :port, :host, and :canonized (see <a
                  href="Session.html#M000233">host_as_string</a>).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000240-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000240-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 144</span>&#x000A;144:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">peer</span>&#x000A;145:       <span class="ruby-ivar">@peer</span> <span class="ruby-operator">||=</span> { <span class="ruby-identifier">:ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span>, <span class="ruby-identifier">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@port</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@host</span>, <span class="ruby-identifier">:canonized</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">host_as_string</span> }&#x000A;146:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000242'>
                <a name='M000242'></a>
                <div class='synopsis'>
                  <span class='name'>poll_message</span>
                  <span class='arguments'>(mode=:nonblock, consume_queue=true)</span>
                </div>
                <div class='description'>
                  <p>
                  Tries to read the next packet from the socket. If mode is :nonblock (the
                  default), this will not block and will return nil if there are no packets
                  waiting to be read. Otherwise, this will block until a packet is available.
                  Note that some packet types (DISCONNECT, IGNORE, UNIMPLEMENTED, DEBUG, and
                  KEXINIT) are handled silently by this method, and will never be returned.
                  </p>
                  <p>
                  If a key-exchange is in process and a disallowed packet type is received,
                  it will be enqueued and otherwise ignored. When a key-exchange is not in
                  process, and consume_queue is true, packets will be first read from the
                  queue before the socket is queried.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000242-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000242-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 165</span>&#x000A;165:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">poll_message</span>(<span class="ruby-identifier">mode</span>=<span class="ruby-identifier">:nonblock</span>, <span class="ruby-identifier">consume_queue</span>=<span class="ruby-keyword kw">true</span>)&#x000A;166:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>&#x000A;167:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">consume_queue</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">allow?</span>(<span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">first</span>)&#x000A;168:           <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">shift</span>&#x000A;169:         <span class="ruby-keyword kw">end</span>&#x000A;170: &#x000A;171:         <span class="ruby-identifier">packet</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">next_packet</span>(<span class="ruby-identifier">mode</span>)&#x000A;172:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">nil?</span>&#x000A;173: &#x000A;174:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">type</span>&#x000A;175:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DISCONNECT</span>&#x000A;176:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Disconnect</span>, <span class="ruby-node">&quot;disconnected: #{packet[:description]} (#{packet[:reason_code]})&quot;</span>&#x000A;177: &#x000A;178:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">IGNORE</span>&#x000A;179:           <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;IGNORE packet recieved: #{packet[:data].inspect}&quot;</span> }&#x000A;180: &#x000A;181:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">UNIMPLEMENTED</span>&#x000A;182:           <span class="ruby-identifier">lwarn</span> { <span class="ruby-node">&quot;UNIMPLEMENTED: #{packet[:number]}&quot;</span> }&#x000A;183: &#x000A;184:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DEBUG</span>&#x000A;185:           <span class="ruby-identifier">send</span>(<span class="ruby-identifier">packet</span>[<span class="ruby-identifier">:always_display</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">:fatal</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:debug</span>) { <span class="ruby-identifier">packet</span>[<span class="ruby-identifier">:message</span>] }&#x000A;186: &#x000A;187:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">KEXINIT</span>&#x000A;188:           <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">accept_kexinit</span>(<span class="ruby-identifier">packet</span>)&#x000A;189: &#x000A;190:         <span class="ruby-keyword kw">else</span>&#x000A;191:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">packet</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">allow?</span>(<span class="ruby-identifier">packet</span>)&#x000A;192:           <span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)&#x000A;193:         <span class="ruby-keyword kw">end</span>&#x000A;194:       <span class="ruby-keyword kw">end</span>&#x000A;195:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000244'>
                <a name='M000244'></a>
                <div class='synopsis'>
                  <span class='name'>push</span>
                  <span class='arguments'>(packet)</span>
                </div>
                <div class='description'>
                  <p>
                  Adds the given packet to the packet queue. If the queue is non-empty, <a
                  href="Session.html#M000242">poll_message</a> will return packets from the
                  queue in the order they were received.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000244-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000244-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 212</span>&#x000A;212:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)&#x000A;213:       <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)&#x000A;214:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000238'>
                <a name='M000238'></a>
                <div class='synopsis'>
                  <span class='name'>rekey!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Requests a rekey operation, and blocks until the operation completes. If a
                  rekey is already pending, this returns immediately, having no effect.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000238-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000238-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 127</span>&#x000A;127:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rekey!</span>&#x000A;128:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">pending?</span>&#x000A;129:         <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">rekey!</span>&#x000A;130:         <span class="ruby-identifier">wait</span> { <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">initialized?</span> }&#x000A;131:       <span class="ruby-keyword kw">end</span>&#x000A;132:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000239'>
                <a name='M000239'></a>
                <div class='synopsis'>
                  <span class='name'>rekey_as_needed</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Returns immediately if a rekey is already in process. Otherwise, if a rekey
                  is needed (as indicated by the socket, see <a
                  href="PacketStream.html#M000208">PacketStream#if_needs_rekey?</a>) one is
                  performed, causing this method to block until it completes.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000239-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000239-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 137</span>&#x000A;137:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rekey_as_needed</span>&#x000A;138:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">pending?</span>&#x000A;139:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">if_needs_rekey?</span> { <span class="ruby-identifier">rekey!</span> }&#x000A;140:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000245'>
                <a name='M000245'></a>
                <div class='synopsis'>
                  <span class='name'>send_message</span>
                  <span class='arguments'>(message)</span>
                </div>
                <div class='description'>
                  <p>
                  Sends the given message via the packet stream, blocking until the entire
                  message has been sent.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000245-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000245-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 218</span>&#x000A;218:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_message</span>(<span class="ruby-identifier">message</span>)&#x000A;219:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send_packet</span>(<span class="ruby-identifier">message</span>)&#x000A;220:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000237'>
                <a name='M000237'></a>
                <div class='synopsis'>
                  <span class='name'>service_request</span>
                  <span class='arguments'>(service)</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a new <a href="Session.html#M000237">service_request</a> packet for
                  the given service name, ready for sending to the server.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000237-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000237-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 120</span>&#x000A;120:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">service_request</span>(<span class="ruby-identifier">service</span>)&#x000A;121:       <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">:byte</span>, <span class="ruby-constant">SERVICE_REQUEST</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">service</span>)&#x000A;122:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000236'>
                <a name='M000236'></a>
                <div class='synopsis'>
                  <span class='name'>shutdown!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Performs a &#8220;hard&#8221; shutdown of the connection. In general, this
                  should never be done, but it might be necessary (in a rescue clause, for
                  instance, when the connection needs to close but you don&#8217;t know the
                  status of the underlying protocol&#8217;s state).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000236-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000236-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 113</span>&#x000A;113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shutdown!</span>&#x000A;114:       <span class="ruby-identifier">error</span> { <span class="ruby-value str">&quot;forcing connection closed&quot;</span> }&#x000A;115:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>&#x000A;116:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000243'>
                <a name='M000243'></a>
                <div class='synopsis'>
                  <span class='name'>wait</span>
                  <span class='arguments'>() {|| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Waits (blocks) until the given block returns true. If no block is given,
                  this just waits long enough to see if there are any pending packets. Any
                  packets read are enqueued (see <a href="Session.html#M000244">push</a>).
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000243-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000243-source'>     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 200</span>&#x000A;200:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait</span>&#x000A;201:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>&#x000A;202:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">yield</span>&#x000A;203:         <span class="ruby-identifier">message</span> = <span class="ruby-identifier">poll_message</span>(<span class="ruby-identifier">:nonblock</span>, <span class="ruby-keyword kw">false</span>)&#x000A;204:         <span class="ruby-identifier">push</span>(<span class="ruby-identifier">message</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">message</span>&#x000A;205:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block_given?</span>&#x000A;206:       <span class="ruby-keyword kw">end</span>&#x000A;207:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
